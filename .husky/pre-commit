#!/usr/bin/env sh
# Resolve the absolute directory of this hook and source husky.sh reliably
HUSKY_DIR="$(cd "$(dirname -- "$0")" && pwd)"
. "$HUSKY_DIR/_/husky.sh"

# 🔍 PRE-COMMIT HOOK - Quality Checks
# Exécute les vérifications de qualité avant chaque commit

echo "🔍 Running pre-commit checks..."

# Run lint-staged to check only staged files
npx lint-staged
if [ $? -ne 0 ]; then
	echo "lint-staged failed. Commit aborted."
	exit 1
fi

# Run lint + architecture check
echo "🔧 Running lint and Clean Architecture checks..."
npm run lint:check
if [ $? -ne 0 ]; then
	echo "Lint or Clean Architecture check failed. Commit aborted."
	exit 1
fi

# Run full test suite as last gate
echo "🧪 Running full test suite..."
npm test --silent --passWithNoTests
if [ $? -ne 0 ]; then
	echo "Tests failed. Commit aborted."
	exit 1
fi

echo "✅ Pre-commit checks completed successfully!"
